(function(e,t){"use strict";if(e===void 0&&(e={}),r===void 0)var r={log:function(){},error:function(){},trace:function(){}};e.config=_(e.config||{}).extend({urlRoot:"/site/api/",queryParams:{},queryParamsMap:{serializer:"serializer",pageSize:"page_size",page:"page",ordering:"order"},responseParamsMap:{count:"count",results:"results"},defaultPageSize:50}),e.QueryParams=t.Model.extend({initialize:function(e,t){_(this).bindAll("on_change"),t||(t={}),this.parent=t.parent,this.on("change",this.on_change)},on_change:function(){var e=this.changedAttributes();e&&1===_(e).keys().length&&"count"in e||this.parent&&this.parent.fetch()},getForQuery:function(e){return e?_(this.attributes).pick("serializer"):_(this.attributes).omit("count")},getPages:function(){return Math.ceil(this.get("count")/this.get("pageSize")||e.config.defaultPageSize)},nextPage:function(){this.set("page",this.get("page")+1)},prevPage:function(){this.set("page",this.get("page")-1)}},{serialize:function(t){var r={};return _(t).each(function(t,i){e.config.queryParamsMap[i]&&(i=e.config.queryParamsMap[i]),r[i]=t===!0?"True":t===!1?"False":t}),r}}),e.TQueried={initQueryParams:function(e){e||(e={}),this.setQueryParams(e.queryParams||{},{fetch:!1})},setQueryParams:function(t,r){var i;"object"!=typeof t?(i={},i[t]=r,r=null):i=t,r||(r={}),this.queryParams&&e.QueryParams.prototype.isPrototypeOf(this.queryParams)||(this.queryParams=new e.QueryParams(this.queryParams||{},{parent:this})),this.queryParams.set(i,{silent:r.fetch===!1||r.silent===!0})},parse:function(r){if(t.Collection.prototype.isPrototypeOf(this)){if(_(r).isArray())return r;var i=r[e.config.responseParamsMap.count];return i!==void 0&&this.setQueryParams({count:i}),r[e.config.responseParamsMap.results]}return r}},e.Model=("AssociatedModel"in t?t.AssociatedModel:t.Model).extend(_({}).extend(e.TQueried,{modelName:"model",constructor:function(e,r){("AssociatedModel"in t?t.AssociatedModel:t.Model).apply(this,[e,r]),this.initQueryParams(r)},onceSet:function(e,t,r){return this.has(e)?t.apply(r,[this,this.get(e)]):this.once("change:"+e,t,r),this}})),e.Collection=t.Collection.extend(_({}).extend(e.TQueried,{constructor:function(e,r){t.Collection.apply(this,[e,r]),this.initQueryParams(r)}}));var i=t.sync;e.sync_api=function(r,o,a){var n=_({}).extend(_(e.config).result("queryParams")),s=t.Model.prototype.isPrototypeOf(o);return s?o.modelName:o.model&&o.model.modelName,o.queryParams?_(n).extend(o.queryParams.getForQuery()):s&&o.collection&&o.collection.queryParams&&_(n).extend(o.collection.queryParams.getForQuery(!0)),_(n).extend(a.queryParams||{}),a.url=(a.url||o.urlRoot||o.model&&o.model.urlRoot||o.collection&&o.collection.urlRoot)+(s&&o.has("id")?o.get("id"):""),window.params=[a.url+"",o.url,o.urlRoot,o.model&&o.model.prototype.urlRoot],a.url+="?"+$.param(e.QueryParams.serialize(n)),i(r,o,a)},t.sync=e.sync_api})(window.barebone===void 0?window.barebone={}:window.barebone,Backbone,jQuery);